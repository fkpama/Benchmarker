trigger:
- none

pool:
  vmImage: ubuntu-latest

parameters:
    - name: PackageVersion
      type: string
      displayName: Package Version
      default: '*'

variables:
    BuildConfiguration: Debug
    FrameworkProjectPath: src/Core/Framework/Framework.csproj
    TestAdapterProjectPath: src/MsTests/TestAdapter/TestAdapter.csproj


steps:

- checkout: 
  clean: true
  fetchDepth: 0
  persistCredentials: true

- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      git tag test-tag HEAD & \
      git push origin test-tag

- task: PowerShell@2
  inputs:
    targetType: 'inline'
    script: |
      &dotnet tool restore
      &build/scripts/AutoVer.ps1

- task: DotNetCoreCLI@2
  displayName: Restore Projects
  inputs:
    command: 'restore'
    projects: |
      $(FrameworkProjectPath)
      $(TestAdapterProjectPath)
    feedsToUse: 'select'
- task: DotNetCoreCLI@2
  inputs:
    command: 'pack'
    packagesToPack: '$(FrameworkProjectPath);$(TestAdapterProjectPath)'
    versioningScheme: 'off'

- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      # Write your commands here
      ls $(Build.ArtifactStagingDirectory)
